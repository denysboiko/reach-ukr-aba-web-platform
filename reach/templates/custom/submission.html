{% extends "base.html" %}
{% load staticfiles %}


{% block libs %}
    <script src='{% static 'js/mapbox-gl.js' %}'></script>
    <link href='{% static 'css/mapbox-gl.css' %}' rel='stylesheet' />

    <link rel="stylesheet" type="text/css" href='{% static 'css/selectize/selectize.min.css' %}' />
    <link rel="stylesheet" type="text/css" href='{% static 'css/selectize/selectize.default.min.css' %}' />


    <script src='{% static 'js/mapbox-gl-geocoder.js' %}'></script>
    <link rel='stylesheet' href='{% static 'css/mapbox-gl-geocoder.css' %}' type='text/css' />

    <script src='{% static 'js/mapbox-gl-draw.js' %}'></script>
    <link rel='stylesheet' href='{% static 'css/mapbox-gl-draw.css' %}' type='text/css'/>
{% endblock libs %}


{% block content %}

    <div class="wrappers" style="width:20%; overflow:auto">
        <!-- Sidebar -->
        <div class="filters" style="height: 100%; overflow: auto;">

{#            <div class="filter">#}
{#                <label>Layers:</label>#}
{#                <nav id="menu"></nav>#}
{#            </div>#}

            <div class="filter">
{#                <button type="button" id="reset" class="btn btn-secondary">Reset Filters</button>#}
                <button type="button" id="modal-toggle" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                    View data
                </button>
            </div>

        </div>
    </div>
    <div class="wrappers" style="width:80%">
        <div id='map-container'></div>
{#    <div id='sectors-legend' class='legend'>#}
{#        <h6>Sectors</h6>#}
{#    </div>#}
    </div>



    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">

            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Enter data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="post" action="">{% csrf_token %}
                    <div class="modal-body">

                        <div class="container">
                            <table id="quest" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Question</th>
                                        <th>Response</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" id="save">Save</button>
                    </div>
                </form>

            </div>
        </div>
    </div>




{% endblock content %}


{% block libs2 %}
    <script src="{% static 'js/d3.min.js' %}"></script>
    <script src="{% static 'js/crossfilter.v1.min.js' %}"></script>
    <script src='{% static 'js/selectize.min.js' %}'></script>

    <script src="{% static 'js/d3-queue.v3.min.js' %}"></script>


    <script>



    function newFeature(lon, lat, id) {


        var feature = {
                        "type": "Feature",
                        "geometry": {
                            "type": "Point",
                            "coordinates": [lon, lat]
                        },
                        "properties": {
                            "id": id
                        }
                    };
        return feature;
    }


    </script>

    <script src="{% static 'js/responses/responses.js' %}">






    </script>
    <script>


    d3.queue()
          .defer(d3.tsv, "{% static 'data/header.txt' %}")
          .defer(d3.tsv, "{% static 'data/Community_KI.txt' %}")
          .await(loadData);


    function loadData(err, fields, data) {

{#        renderTable(fields[0], data[0])#}
        loadResponses(fields[0], data)

    }

    function renderTable(fields, data) {

        var questions = Object.keys(data);
            var Qs = [];
            questions.forEach(function (e, i) {
                var obj = {};
                obj['question'] = fields[e];
                obj['response'] = data[e];
                Qs.push(obj)
            });


            d3.select("#quest > tbody").html("")

            var row = d3.select("#quest > tbody")
                .selectAll("#quest > tbody")
                .data(Qs)
                .enter()
                .append("tr");

                row.append("td")
                .text(function (d) {
                    return d['question']
                });

                row.append("td")
                .text(function (d) {
                    return d['response'];
                });
    }


    </script>


{% endblock libs2 %}