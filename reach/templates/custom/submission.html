{% extends "base.html" %}
{% load staticfiles %}


{% block libs %}
    <script src='{% static 'js/mapbox-gl.js' %}'></script>
    <link href='{% static 'css/mapbox-gl.css' %}' rel='stylesheet' />

    <link rel="stylesheet" type="text/css" href='{% static 'css/selectize/selectize.min.css' %}' />
    <link rel="stylesheet" type="text/css" href='{% static 'css/selectize/selectize.default.min.css' %}' />


    <script src='{% static 'js/mapbox-gl-geocoder.js' %}'></script>
    <link rel='stylesheet' href='{% static 'css/mapbox-gl-geocoder.css' %}' type='text/css' />

    <script src='{% static 'js/mapbox-gl-draw.js' %}'></script>
    <link rel='stylesheet' href='{% static 'css/mapbox-gl-draw.css' %}' type='text/css'/>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">

{% endblock libs %}


{% block content %}

    <div class="wrappers" style="width:20%; overflow:auto">
        <!-- Sidebar -->
        <div class="filters" style="height: 100%; overflow: auto;">

{#            <div class="filter">#}
{#                <label>Layers:</label>#}
{#                <nav id="menu"></nav>#}
{#            </div>#}

            <div class="filter">
{#                <button type="button" id="reset" class="btn btn-secondary">Reset Filters</button>#}
{#                <button type="button" id="change-color" class="btn btn-primary">#}
{#                    Change color#}
{#                </button>#}
                <span id="counter"></span> entries
            </div>
            <div class="filter">
                <label for="questions">Color points by</label>
                <select id="questions"></select>
            </div>
        </div>
    </div>
    <div class="wrappers" style="width:80%">

        <div id='map-container'></div>
        <div id='responses-legend' class='legend'>
            <h6>Responses</h6>
        </div>

    </div>



    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">

            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Enter data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="post" action="">{% csrf_token %}
                    <div class="modal-body">

                        <div class="container">
                            <table id="quest" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Question</th>
                                        <th>Response</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" id="save">Save</button>
                    </div>
                </form>

            </div>
        </div>
    </div>




{% endblock content %}


{% block libs2 %}
    <script src="{% static 'js/d3.min.js' %}"></script>
    <script src="{% static 'js/crossfilter.v1.min.js' %}"></script>
    <script src='{% static 'js/selectize.min.js' %}'></script>

    <script src="{% static 'js/d3-queue.v3.min.js' %}"></script>


    <script>



    function newFeature(lon, lat, id, data) {

        data['id'] = id;

        return {
            "type": "Feature",
            "geometry": {
                "type": "Point",
                "coordinates": [lon, lat]
            },
            "properties": data
        };
    }


    </script>

    <script src="{% static 'js/responses/responses.js' %}">






    </script>
    <script>


    d3.queue()
          .defer(d3.tsv, "{% static 'data/header.txt' %}")
          .defer(d3.tsv, "{% static 'data/Community_KI.txt' %}")
        .defer(d3.json, "{% static 'data/Single Choices.json' %}")
        .defer(d3.json, "{% static 'data/quest.json' %}")
          .await(loadData);


    function loadData(err, fields, data, choices, quest) {

{#        renderTable(fields[0], data[0])#}

        loadResponses(fields[0], data, choices[0], quest[0]);

        d3.select("#counter").html(data.length);




    }

    function renderTable(fields, data) {

        var questions = Object.keys(data);

        var Qs = questions.map(function (key) {
            return {
                'question': fields[key],
                'response': data[key]
            };
        });



        d3.select("#quest > tbody").html("");

        var row = d3.select("#quest > tbody")
            .selectAll("#quest > tbody")
            .data(Qs)
            .enter()
            .append("tr");

            row.append("td")
            .text(function (d) {
                return d['question']
            });

            row.append("td")
            .text(function (d) {
                return d['response'];
            });
{#                $('#quest').DataTable();#}
    }


    </script>

    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.10.15/af-2.2.0/b-1.3.1/datatables.min.css"/>

    <script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.15/af-2.2.0/b-1.3.1/datatables.min.js"></script>

{% endblock libs2 %}